import { Button, Link } from "@mui/material";
import type { NextPage } from "next";
import Head from "next/head";
import { useEffect, useState } from "react";
import {
  orderByNewest,
  tutorialMetaData,
  filterForTopic,
  filterForLanguages,
  filterForTags,
  orderByAlphabetical,
  SortOptions,
  orderByOldest,
} from "../../src/tutorials/tutorialsDataService";
import { Languages, Topic, Tags } from "../../src/tutorials/types";
import { PageContainer } from "../../components/layout/PageContainer";
import { FilterMenu } from "../../components/layout/FilterMenu";

const Tutorials: NextPage = () => {
  // TODO: add temp buttons the user can click to toggle filters, these add to the setFilters (take current, add new, setNew)
  // TODO: Clear Up Console Errors

  const [sortOption, setSortOption] = useState(SortOptions.Newest);
  const [order, setOrder] = useState(tutorialMetaData);

  const [enabledTopicFilter, setEnabledTopicFilter] = useState();
  const [enabledLanguageFilters, setEnabledLanguageFilters] = useState([]);
  const [enabledTagFilters, setEnabledTagsFilters] = useState([]);

  const [filteredSortedData, setFilteredSortedData] =
    useState(tutorialMetaData);

  useEffect(() => {
    switch (sortOption) {
      //Flakey
      case SortOptions.Alphabetical:
        setOrder(orderByAlphabetical(tutorialMetaData));
        break;
      case SortOptions.Newest:
        setOrder(orderByNewest(tutorialMetaData));
        break;
      case SortOptions.Oldest:
        setOrder(orderByOldest(tutorialMetaData));
        break;
    }

    let filteredData = order;

    filteredData = enabledTopicFilter
      ? filterForTopic(filteredData, enabledTopicFilter)
      : filteredData;

    filteredData = enabledLanguageFilters.length
      ? filterForLanguages(filteredData, enabledLanguageFilters)
      : filteredData;

    filteredData = enabledTagFilters.length
      ? filterForTags(filteredData, enabledTagFilters)
      : filteredData;

    setFilteredSortedData(filteredData);
  }, [
    order,
    sortOption,
    enabledTopicFilter,
    enabledLanguageFilters,
    enabledTagFilters,
  ]);

  // Refactor
  const listItems = filteredSortedData.map((link) => (
    <li key={link.title}>{link.title}</li>
  ));
  return (
    <div>
      <Head>
        <title>Tutorials</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <PageContainer>
        <FilterMenu setSortOption={setSortOption} />

        <Link
          href={`/tutorials/programming/quickly-setup-next-js-with-typescript`}
        >
          <a>Quickly Setup NextJs</a>
        </Link>

        <ul>{listItems}</ul>
      </PageContainer>
    </div>
  );
};

export default Tutorials;
