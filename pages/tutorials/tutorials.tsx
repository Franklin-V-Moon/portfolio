import { Button, Link } from "@mui/material";
import type { NextPage } from "next";
import Head from "next/head";
import { useEffect, useState } from "react";
import {
  orderByNewest,
  tutorialMetaData,
  filterForTopic,
  filterForLanguages,
  filterForTags,
  orderByAlphabetical,
  SortOptions,
  orderByOldest,
} from "../../src/tutorials/tutorialsDataService";
import { Languages, Topic, Tags } from "../../src/tutorials/types";
import { PageContainer } from "../../components/layout/PageContainer";
import { SortButton } from "../../components/buttons/SortButton";
import { FilterTopicButton } from "../../components/buttons/FilterTopicButton";

const Tutorials: NextPage = () => {
  // Shrink useEffect below into smaller ones
  // TODO: add temp buttons the user can click to toggle filters, these add to the setFilters (take current, add new, setNew)
  // TODO: Clear Up Console Errors

  const [sortMetaDataBy, setSortMetaDataBy] = useState(SortOptions.Newest);
  const [sortedMetaData, setSortedMetaData] = useState(tutorialMetaData);

  const [topicFilter, setTopicFilter] = useState<Topic | undefined>();
  const [languagesFilter, setLanguagesFilter] = useState([]);
  const [tagsFilter, setTagsFilter] = useState([]);

  const [filteredMetaData, setFilteredData] = useState(sortedMetaData);

  useEffect(() => {
    switch (sortMetaDataBy) {
      case SortOptions.Newest:
        setSortedMetaData(orderByNewest(tutorialMetaData));
        break;
      case SortOptions.Oldest:
        setSortedMetaData(orderByOldest(tutorialMetaData));
        break;
      case SortOptions.Alphabetical:
        setSortedMetaData(orderByAlphabetical(tutorialMetaData));
        break;
    }
  }, [sortMetaDataBy]);

  useEffect(() => {
    let filteredData = sortedMetaData;

    if (topicFilter) {
      filteredData = filterForTopic(filteredData, topicFilter);
    }

    if (languagesFilter.length) {
      filteredData = filterForLanguages(filteredData, languagesFilter);
    }

    if (tagsFilter.length) {
      filteredData = filterForTags(filteredData, tagsFilter);
    }

    setFilteredData(filteredData);
  }, [sortedMetaData, topicFilter, languagesFilter, tagsFilter]);

  return (
    <div>
      <Head>
        <title>Tutorials</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <PageContainer>
        <SortButton setSortMetaDataBy={setSortMetaDataBy} />
        <FilterTopicButton setTopicFilter={setTopicFilter} />

        <Link
          href={`/tutorials/programming/quickly-setup-next-js-with-typescript`}
        >
          <a>Quickly Setup NextJs</a>
        </Link>

        <ol>
          {filteredMetaData.map((link) => (
            <li key={link.title}>{link.title}</li>
          ))}
        </ol>
      </PageContainer>
    </div>
  );
};

export default Tutorials;
